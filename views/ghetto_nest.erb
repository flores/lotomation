<script src="js/jquery.knob.js"></script>

<div class="row">
  <div class="col-lg-4 col-md-4 col-xs-4">
    <center>
    <p>living room</p>
    <h1><bold><span class="temp-pistat"><%= check_value('pistat-temperature') %></span></bold>F</h1>
    </center>
  </div>
  <div class="col-lg-4 col-md-4 col-xs-4">
    <center>
    <p>bedroom</p>
    <h1><bold><span class="temp-bedpi"><%= check_value('bedpi-temperature') %></span></bold>F</h1>
    </center>
  </div>
  <div class="col-lg-4 col-md-4 col-xs-4">
    <center>
    <p>outside</p>
    <% weather_outside = weather(90014).split(',') %>
    <h1><bold><span><%= weather_outside[0] %></span></bold></h1>
    </center>
  </div>
</div>

<div class="row" id='control' style="margin-top: 30px">
    <div class="col-lg-12 col-md-12 col-xs-12 btn-group" id="buttoncontrol">
      <center>
        <button type="button" style="width: 50%" class="btn btn-lg <%= check_state('thermostat') == 'off' ? 'btn-danger' : 'btn-success' %> dropdown-toggle" data-toggle="dropdown">
          <%= check_state('thermostat') == 'off' ? 'heater and a/c' : check_state('thermostat') %> <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">                                  
          <li><a href="/thermostat/air-conditioner">a/c</a></li>                
          <li><a href="/thermostat/heater">heater</a></li>                      
          <li><a href="/maintain/enforce/on/bedpi">maintain temp in bedroom</a></li>
          <li><a href="/maintain/enforce/on/pistat">maintain temp in livingroom</a></li>
          <li><a href="/thermostat/off">off</a></li>                            
        </ul> 
      </center>
    </div>
</div>

  <div class="row" id='control' style="margin-top: 20px">
    <div class="col-lg-12 col-md-12 col-xs-12 btn-group">
      <center>
      <input type="text" class="dial" value="<%= check_value('maintain-temp') == "unknown" ? 76 : check_value('maintain-temp') %>" data-rotation="anticlockwise" data-min="60" data-max="85" data-displayPrevious=true>
      <%= "<h3>maintaining temperature</h3>" if check_state('maintain') == 'on' %>
      </center>
    </div>
  </div>

  <div class="row" id='control' style="margin-top: 20px">
    <div class="panel panel-default col-lg-5 col-md-5 col-xs-12" id="history">
    <div>
  </div>
<script>
$(function() {
  $(".dial").knob({
    'release': function(temperature) {
      jQuery.post('/maintain/temp', {temp: temperature});
    }
  });
});
</script>

<script type="text/javascript">
  $(document).ready(function() {
    $("#history").load('/thermostat/historical');
    var interval = setInterval("updatetemp1()", 500);
    var interval = setInterval("updatetemp2()", 500);
    var interval1 = setInterval("updatebuttons();", 5000);
    var interval2 = setInterval("updatelog();", 200);
  });

  function updatetemp2() {
    $(".temp-bedpi").load('/temperature/bedpi');
    console.log('updated temp2');
  };
  function updatetemp1() {
    $(".temp-pistat").load('/temperature/pistat');
    console.log('updated temp1');
  };
  function updatebuttons() {
    $("#buttoncontrol").load('/buttoncontrol');
    console.log('updated buttons');
  };
  function updatelog() {
    $("#history").load('/thermostat/historical');
    console.log('updated temp');
  };
</script>
